Reported-by: Byrial Jensen <address@hidden>
---
 gettext-tools/src/x-php.c          |   15 ++++++-
 3 files changed, 93 insertions(+), 3 deletions(-)
 create mode 100755 gettext-tools/tests/xgettext-php-5

diff --git a/gettext-tools/src/x-php.c b/gettext-tools/src/x-php.c
index 4781005..b2174f8 100644
--- a/gettext-tools/src/x-php.c
+++ b/gettext-tools/src/x-php.c
@@ -1161,12 +1161,18 @@ phase4_get (token_ty *tp)
                 int c3 = phase1_getc ();
                 if (c3 == '<')
                   {
-                    /* Start of here document.
+                    /* Start of here and now document.
                        Parse whitespace, then label, then newline.  */
                     do
                       c = phase3_getc ();
                     while (c == ' ' || c == '\t' || c == '\n' || c == '\r');
 
+                    /* a nowdoc encloses the label into single quotes */
+                    if (c == '\'')
+                      {
+                        c = phase3_getc ();
+                      }
+
                     bufpos = 0;
                     do
                       {
@@ -1178,9 +1184,14 @@ phase4_get (token_ty *tp)
                         buffer[bufpos++] = c;
                         c = phase3_getc ();
                       }
-                    while (c != EOF && c != '\n' && c != '\r');
+                    while (c != EOF && c != '\n' && c != '\r' && c != '\'');
                     /* buffer[0..bufpos-1] now contains the label.  */
 
+                    if (c == '\'') /* eat the nowdoc single quote */
+                      {
+                        c = phase3_getc ();
+                      }
+
                     /* Now skip the here document.  */
                     for (;;)
                       {
-- 
1.7.9.2
